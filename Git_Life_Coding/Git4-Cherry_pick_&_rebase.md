# Git4 - Cherry-pick & rebase



### intro

버전 관리를 하다보면 어떤 브랜치의 하나의 버전만 머지시키고 싶을 때가 있다. 이를 가능하게 해주는 것이 cherry-pick이다.

다른 두 브랜치를 머지할 때 공통된 버전이 탄생한다. 이 경우 작업의 흐름이 브랜치 병렬로 나타나게 된다. 이 작업이 수십개 가 될 경우 작업의 내용이 어려울 수 있다. 이를 해결하기 위해 일렬로 나타나게 만들고 싶을 때 rebase를 사용한다.

커밋의 순서와 관계를 임의로 조정하게 만들 수 있다.





### check-pick의 개념과 사용

어떤 디렉토리를 저장소로 만들고 두 개의 브랜치로 작업을 한다.

우리는 보통 작업을 끝낸 뒤에 커밋을 찍는다. 

어떤 한 브랜치의 커밋 내용을 다른 브랜치로 머지 시키고 싶다.  

cherry pick기능을 사용하려면 병합할 브랜치로 이동해야 한다. 그 상태에서 어떤 브랜치의 커밋을 체리픽 하려면

```
git cherry-pick 커밋아이디
```

를 한뒤 엔터를 치면 커밋아이디에 해당하는 변경사항이 추가된다. 체리픽은 변화를 가져오는 것이다. 그 전에 있었던 변화를 가져오지는 않는다.





###  rebase의 개념과 사용

우리가 원하는 것은 브랜치가 병렬로 흘러갈 때 한 작업이 끝날 때 다른 마스터 작업이 진행되었다는 것을 아는 것이다.

현재 마스터를 리베이스하여 다른 브랜치로 rebase한다는 것은 master의 베이스를 다른 브랜치의 최신 버전을 바꾸겠다는 것이다.

남들이 보면 브랜치의 모든 작업이 마스터의 작업 이전에 일어난 것으로 볼 수 있다. 

일단 master로 이동한 뒤 다음과 같은 명령어를 친다.

```powershell
git rebase 브랜치이름
```

rebase가 되는 과정은 base할 브랜치에서 master브랜치의 커밋 변경 내용을 하나하나 병합해 나간다. 그런 뒤 모든 병합이 끝나면 다시 커밋을 찍어 rebase를 완료한다.

그래서 로그를 찍어보면 브랜치의 모든 작업이 끝난 뒤에 마스터의 커밋이 찍히는 것 처럼 보인다. 따라서 직렬처럼 보인다.



merge와 rebase의 차이점은 

Merge는 두 브랜치를 합쳐서 새로운 버전을 만드는 것이고, rebase는 base를 다른 브랜치로 바꾸는 것이다.





###  cherry-pick 충돌의 원인과 해결 1/2

브랜치의 cherrypick 과정 에서 충돌이 발생할 수 있다. 그 과정에서 수동으로 충돌난 부분을 해결해주어야 한다. 

충돌이 일어나는 원인은 각각의 커밋이 같은 부분에서 수정이 일어나 동일한 부분이 다른 상태를 가지고 있을 때 일어난다.

그리고 cherrypick 되는 커밋 이전의 변화 내용은 새로 만들어지는 버전에 포함되지 않는다.





### cherry-pick 충돌의 원인과 해결 2/2

충돌이 나게 되면 에러가 발생하게 된다. `git status`를 통해 어떤 파일에서 충돌이 발생했는지 확인할 수 있다.

git mergetool을 통해 로컬에서 머지 작업을 실행하는 것이 좋다.

같은 곳이 수정된 두 개의 커밋을 다룰 때 충돌이 발생할 때 정해주고 저장한다.

그러면 다른 버전이 생성되고 다른 브랜치의 버전을 현재 브랜치로 가져와 머지가 된다.





### rebase의 충돌의 원인과 해결 1/2

rebase를 하게되면 가장 먼저 git은 rebase의 커밋으로 head를 옮긴다.

그리고 브랜치에 있는 순서상 첫번째 커밋을 가져와 cherrypick을 한다. 이 경우 서로 같은 곳을 수정했을 때 충돌이 발생할 수 있다.

이 경우 conflict를 해결해주면 rebase가 진행된다.

첫 번째 커밋과의 머지에서 아무런 연관이 없을 때 다음 커밋과 머지된 버전과의 머지를 시도한다. 

머지 과정에서 수정된것을 우선으로 한다.  

rebase가 끝나면 head는 rebase된 최신의 상태를 가리키고 이름도 rebase할 브랜치의 이름이 된다.





### rebase의 충돌의 원인과 해결 2/2

rebase하는 명령어는

```
git rebase 리베이스될브랜치이름
```

충돌을 해결한 뒤 계속해서 rebase를 진행하려면

```powershell
git rebase --continue
```

rebase가 끝난 뒤 

```
git log --oneline --all --graph
```

를 통해 rebase가 잘 되었는지 확인해보자.







